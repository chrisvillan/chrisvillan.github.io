<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Data Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
            min-height: 100vh;
            background-color: #f0f0f0;
            flex-direction: column;
        }
        h1 {
            width: 90%;
            margin-bottom: 10px;
        }

        .table-container {
            width: 90%;
            border: 1px solid #ccc;
            border-radius: 8px;
            overflow: hidden;
        }

        .text-input {
            width: 40%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
            font-size: calc(12px + 1vw);
        }

        th {
            background-color: #f2f2f2;
        }

        tr {
            height: 6vh; /* Each row occupies 6% of the viewport height */
        }

        tr.clickable {
            cursor: pointer;
        }

        tr.clickable:hover {
            background-color: #f0f0f0;
        }

        tr.highlight {
            background-color: #cceeff;
        }

        #updateContainer {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #updateContainer input[type="text"],
        #updateContainer button  {
            padding: 6px;
            margin-right: 10px;
            margin-bottom: 10px;
            height: 6vh; /* Match the height of table rows */
            flex-grow: 1; /* Allow the input to grow and fill available space */
            font-size: calc(0.8rem + 1vw); /* Responsive font size */
        }

        #updateContainer button {
            cursor: pointer;
            font-size: calc(0.8rem + 1vw); /* Responsive font size */
        }
        /* Media query for smaller screens */
        @media (max-width: 768px) {
            th, td {
                font-size: 16px; /* Adjust font size for smaller screens */
            }

            /* Additional adjustments if needed */
        }

    </style>

    
</head>
<body>
    <div id="updateContainer">
        <input type="text" id="userName" placeholder="Your Name" class="text-input">
        <button onclick="updateSheet()">Update</button>
        <button onclick="removeSelected()">Remove</button>
    </div>

    <div class="table-container">
        <table id="dataContainer">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Price</th>
                    <th>Name</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>  

    
    <script>
        var selectedRows = [];
        var baseUrl = 'https://script.google.com/macros/s/AKfycbzI_sFxJ3dcv1QihMHV0t9ZTk3xtPzVjwFo9ICmkRu2masmAXg4pUIKB0NZtjUzsyw1jA/exec';
        // Function to fetch all data from the Google Apps Script web app
        function fetchData() {
            fetch(baseUrl)
                .then(response => response.json())
                .then(data => {
                    var tableBody = document.querySelector('#dataContainer tbody');
                    tableBody.innerHTML = '';

                    if (data.error) {
                        var errorRow = document.createElement('tr');
                        var errorCell = document.createElement('td');
                        errorCell.textContent = 'Error fetching data';
                        errorRow.appendChild(errorCell);
                        tableBody.appendChild(errorRow);
                    } else {
                        data.data.forEach(row => {
                            var item = row[0];
                            var price = row[1];
                            var name = row[2];
                            var newRow = document.createElement('tr');
                            newRow.innerHTML = `<td>${item}</td><td>$${price}</td><td>${name}</td>`;
                            newRow.classList.add('clickable');
                            newRow.addEventListener('click', () => toggleHighlight(newRow));
                            tableBody.appendChild(newRow);
                        });
                        document.getElementById('updateContainer').style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function toggleHighlight(row) {
            row.classList.toggle('highlight');
            var index = selectedRows.indexOf(row);
            if (index === -1) {
                selectedRows.push(row);
            } else {
                selectedRows.splice(index, 1);
            }
        }


        function updateSheet() {
            var userName = document.getElementById('userName').value.trim();
            if (userName && selectedRows.length > 0) {
                var selectedItems = selectedRows.map(row => row.cells[0].textContent);
                
                var data = {
                    sheetName: 'Sheet1',
                    userName: userName,
                    selectedItems: selectedItems,
                    action: 'Update'
                };

                fetch(baseUrl, {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    redirect: 'follow'
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    fetchData(); // Fetch the updated data and update the table

                    alert('Update successful!');
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Check if the error is a CORS-related error
                    if (error.toString().includes('TypeError: Failed to fetch')) {
                        // Log the error to the console without showing an alert
                        console.error('CORS Error: Failed to fetch data due to CORS policy');
                        // Fetch the updated data and update the table
                        fetchData();
                        alert('Update successful!');
                    } else {
                        // Show an alert for other types of errors
                        alert('Update failed. Please try again.');
                    }
                });
            } else {
                alert('Please select items and enter your name.');
            }
        }

        function removeSelected() {
            var userName = document.getElementById('userName').value.trim();
            if (userName && selectedRows.length > 0) {
                var selectedItems = selectedRows.map(row => row.cells[0].textContent);
                
                var data = {
                    sheetName: 'Sheet1',
                    userName: userName,
                    selectedItems: selectedItems,
                    action: 'Remove'
                };

                fetch(baseUrl, {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    redirect: 'follow'
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    fetchData(); // Fetch the updated data and update the table

                    alert('Update successful!');
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Check if the error is a CORS-related error
                    if (error.toString().includes('TypeError: Failed to fetch')) {
                        // Log the error to the console without showing an alert
                        console.error('CORS Error: Failed to fetch data due to CORS policy');
                        // Fetch the updated data and update the table
                        fetchData();
                        alert('Update successful!');
                    } else {
                        // Show an alert for other types of errors
                        alert('Update failed. Please try again.');
                    }
                });
            } else {
                alert('Please select items and enter your name.');
            }
        }

        // Call the fetchData function to fetch all data when the page loads
        window.onload = function() {
            fetchData();
            document.getElementById('updateContainer').style.display = 'block';
        };
    </script>
</body>
</html>
